function confirmAddAllDL(){var e=confirm("Are you sure you want to add all these specimens to the data loan?");if(e==true){document.location="/Loan.cfm?action=addAllDataLoanItems&transaction_id="+$("#transaction_id").val()}else{return false}}function confirmAddAllPartLoan(){var e=$("#part_name").val();var t="Are you sure you want to add all found "+e+" to the loan?";var n=confirm(t);if(n==true){document.location="/Loan.cfm?action=addAllSrchResultLoanItems&transaction_id="+$("#transaction_id").val()+"&part_name="+encodeURIComponent(e)}else{return false}}function closeCustom(){var e="SpecimenResults.cfm?"+$("#mapURL").val();window.location=e}function getPostLoadJunk(){var e=new Array;$("div[id^='CatItem_']").each(function(){var t=this.id.split("_")[1];e.push(t)});var t=e.toString();insertMedia(t);insertTypes(t);injectLoanPick();displayMedia()}function displayMedia(e){$("div[id^='jsonmedia_']").each(function(){var e=$.parseJSON($("#"+this.id).html());if(e.ROWCOUNT>0){var t='<div class="shortThumb"><div class="thumb_spcr">&nbsp;</div>';for(i=0;i<e.ROWCOUNT;++i){if(e.DATA.mimecat[i]=="audio"&&e.DATA.media_uri[i].split(".").pop()=="mp3"){t+='<div class="one_thumb">';t+="<audio controls>";t+='<source src="'+e.DATA.media_uri[i]+'" type="audio/mp3">';t+='<a href="/exit.cfm?target='+e.DATA.media_uri[i]+'" target="_blank">download</a>';t+="</audio> ";t+='<br><a target="_blank" href="/media/'+e.DATA.media_id[i]+'">Media Detail</a></p></div>'}else{var n="/component/functions.cfc?method=getMediaPreview&preview_uri="+e.DATA.preview_uri[i]+"&media_type="+e.DATA.mimecat[i]+"&returnformat=json&queryformat=column";$.ajax({url:n,dataType:"json",async:false,success:function(n){t+='<div class="one_thumb">';t+='<a href="/exit.cfm?target='+e.DATA.media_uri[i]+'" target="_blank">';t+='<img src="'+n+'" class="theThumb"></a>';t+="<p>"+e.DATA.mimecat[i]+" ("+e.DATA.mime_type[i]+")";t+='<br><a target="_blank" href="/media/'+e.DATA.media_id[i]+'">Media Detail</a></p></div>'}})}}t+='<div class="thumb_spcr">&nbsp;</div></div>';$("#"+this.id).html(t)}else{$("#"+this.id).html("")}})}function insertMedia(e){var t=document.createElement("DIV");t.id="ajaxStatus";t.className="ajaxStatus";t.innerHTML="Checking for Media...";document.body.appendChild(t);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getMedia",idList:e,returnformat:"json",queryformat:"column"},function(e){try{var t=document.getElementById("ajaxStatus");t.innerHTML="Processing Media....";for(i=0;i<e.ROWCOUNT;++i){var n;var r=e.DATA.COLLECTION_OBJECT_ID[i];var s=e.DATA.MEDIA_ID[i];var o=e.DATA.MEDIA_RELATIONSHIP[i];if(o=="cataloged_item"){n="CatItem_"+r}else if(o=="collecting_event"){n="SpecLocality_"+r}if(n.length>0){var u=document.getElementById(n);var a='<a href="/MediaSearch.cfm?action=search&media_id='+s+'" class="mediaLink" target="_blank" id="mediaSpan_'+r+'">';a+="Media";a+="</a>";u.innerHTML+=a}}document.body.removeChild(t)}catch(f){t=document.getElementById("ajaxStatus");document.body.removeChild(t)}})}function insertTypes(e){var t=document.createElement("DIV");t.id="ajaxStatus";t.className="ajaxStatus";t.innerHTML="Checking for Types...";document.body.appendChild(t);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getTypes",idList:e,returnformat:"json",queryformat:"column"},function(e){var t=document.getElementById("ajaxStatus");try{t.innerHTML="Processing Types....";for(i=0;i<e.ROWCOUNT;++i){var n=e.DATA.COLLECTION_OBJECT_ID[i];var r=e.DATA.TYPELIST[i];var s="CatItem_"+n;if(s.length>0){var o=document.getElementById(s);var u='<div class="showType">'+r+"</div>";o.innerHTML+=u}}}catch(a){}document.body.removeChild(t)})}function injectLoanPick(){var e=$("#transaction_id").val();if(e){$("body").append('<div id="ajaxStatus" class="ajaxStatus">Feching Loan Pick...</div>');jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getLoanPartResults",transaction_id:e,returnformat:"json",queryformat:"column"},function(e){$("div[id^='CatItem_']").each(function(){var t=this.id.split(/_(.+)?/)[1];var n=false;var s='<table border width="100%">';for(i=0;i<e.ROWCOUNT;++i){if(e.DATA.COLLECTION_OBJECT_ID[i]==t){n=true;s+='<tr><td nowrap="nowrap" class="specResultPartCell"><i>'+e.DATA.PART_NAME[i];if(e.DATA.SAMPLED_FROM_OBJ_ID[i]>0){s+="&nbsp;sample"}s+="&nbsp;("+e.DATA.COLL_OBJ_DISPOSITION[i]+")</i> ["+e.DATA.BARCODE[i]+"]";s+='</td><td nowrap="nowrap" class="specResultPartCell">';s+='Remark:&nbsp;<input type="text" name="item_remark" size="10" id="item_remark_'+e.DATA.PARTID[i]+'">';s+='</td><td nowrap="nowrap" class="specResultPartCell">';s+='Instr.:&nbsp;<input type="text" name="item_instructions" size="10" id="item_instructions_'+e.DATA.PARTID[i]+'">';s+='</td><td nowrap="nowrap" class="specResultPartCell">';s+='Subsample?:&nbsp;<input type="checkbox" name="subsample" id="subsample_'+e.DATA.PARTID[i]+'">';s+='</td><td nowrap="nowrap" class="specResultPartCell">';s+='<input type="button" id="theButton_'+e.DATA.PARTID[i]+'"';s+=' class="insBtn"';if(e.DATA.TRANSACTION_ID[i]>0){s+=' onclick="" value="In Loan">'}else{s+=' value="Add" onclick="addPartToLoan(';s+=e.DATA.PARTID[i]+');">'}if(e.DATA.ENCUMBRANCE_ACTION[i]!==null){s+="<br><i>Encumbrances:&nbsp;"+e.DATA.ENCUMBRANCE_ACTION[i]+"</i>"}s+="</td></tr>"}}if(n){s+="</table>";$("#CatItem_"+t).append(s)}});$("#ajaxStatus").remove()})}}function addPartToLoan(e){var t="item_remark_"+e;var n="item_instructions_"+e;var r="subsample_"+e;var i=document.getElementById(t).value;var s=document.getElementById(n).value;var o=document.getElementById(r).checked;if(o==true){o=1}else{o=0}var u=document.getElementById("transaction_id").value;jQuery.getJSON("/component/functions.cfc",{method:"addPartToLoan",transaction_id:u,partID:e,remark:i,instructions:s,subsample:o,returnformat:"json",queryformat:"column"},function(e){var t=e.split("|");var n=t[0];if(n==1){var r="theButton_"+t[1];var i=document.getElementById(r);i.value="In Loan";i.onclick=""}else{var s=t[1];alert("An error occured!\n"+s)}})}function reporter(e){var t=document.getElementById("goWhere").value;if(t.length==0){alert("Pick a tool, then click the button.");return false}var n=e;var r="guid";var i=t;var s="?";if(t.indexOf("?")>0){s="&"}i+=s;i+="&table_name="+n;i+="&sort="+r;var o=window.open(i)}function removeRows(){var e=$("#specresults").jtable("selectedRows");if(e.length>0){var t=[];e.each(function(){var e=$(this).data("record");t.push(e.COLLECTION_OBJECT_ID)});var n="/SpecimenResults.cfm?"+$("#mapURL").val()+"&exclCollObjId="+t.join(",");document.location=n}else{alert("select rows, then click")}}function addCoordinates(e){if($("#refineSearchTerms").is(":visible")){if($("#coordinates").length){$("#coordinates").val(e)}else{jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"coordinates",returnformat:"json",queryformat:"column"},function(t){$("#stermwdgtbl tr:last").after(t);$("#newTerm option[value='coordinates']").remove();$("#coordinates").val(e)})}}else{alert("turn search terms on, then try that")}}function initialize(){var e={zoom:3,center:new google.maps.LatLng(55,-135),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:false,scaleControl:true};map=new google.maps.Map(document.getElementById("spresmapdiv"),e)}function resizeMap(e){var t=map.getBounds();$("#spresmapdiv").removeClass().addClass(e);x=map.getZoom();c=map.getCenter();google.maps.event.trigger(map,"resize");map.setZoom(x);map.setCenter(c);map.fitBounds(t);jQuery.getJSON("/component/functions.cfc",{method:"changeUserPreference",pref:"srmapclass",val:e,returnformat:"json",queryformat:"column"})}function queryByViewport(){if(!$("#refineSearchTerms").is(":visible")){alert("Turn on the refine widget, then try that click.");return false}var e=map.getBounds();var t=e.getNorthEast().lat();var n=e.getNorthEast().lng();var r=e.getSouthWest().lat();var i=e.getSouthWest().lng();if($("#nelat").length==0){jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"nelat",returnformat:"json",queryformat:"column"},function(e){$("#stermwdgtbl tr:last").after(e);$("#newTerm option[value='nelat']").remove();$("#nelat").val(t)})}else{$("#nelat").val(t)}if($("#nelong").length==0){jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"nelong",returnformat:"json",queryformat:"column"},function(e){$("#stermwdgtbl tr:last").after(e);$("#newTerm option[value='nelong']").remove();$("#nelong").val(n)})}else{$("#nelong").val(n)}if($("#swlat").length==0){jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"swlat",returnformat:"json",queryformat:"column"},function(e){$("#stermwdgtbl tr:last").after(e);$("#newTerm option[value='swlat']").remove();$("#swlat").val(r)})}else{$("#swlat").val(r)}if($("#swlong").length==0){jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"swlong",returnformat:"json",queryformat:"column"},function(e){$("#stermwdgtbl tr:last").after(e);$("#newTerm option[value='swlong']").remove();$("#swlong").val(i)})}else{$("#swlong").val(i)}}function checkMapBB(){if($("#nelat").length>0&&$("#nelong").length>0&&$("#swlat").length>0&&$("#swlong").length>0){var e=new google.maps.LatLng($("#swlat").val(),$("#swlong").val());var t=new google.maps.LatLng($("#nelat").val(),$("#nelong").val());var n=new google.maps.LatLngBounds(e,t);map.fitBounds(n)}}var map;var bounds;$(document).ready(function(){jQuery("#cntr_refineSearchTerms").html("<img src='/images/indicator.gif'>");var e="/component/SpecimenResults.cfc?method=get_specSrchTermWidget&returnformat=plain";jQuery.get(e,function(e){jQuery("#cntr_refineSearchTerms").html(e)});initialize();var t=[];var n=new google.maps.InfoWindow;var r=$("#cfgml").val();if(r.length==0){return false}var i=r.split(";");for(var s=0;s<i.length;s++){var o=i[s];var u=o.split(",");var a=u[0];var f=u[1];var l=u[2];var c=u[3];var h=new google.maps.LatLng(f,l);var p={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.15,map:map,center:h,radius:parseInt(c),zIndex:-99};crcl=new google.maps.Circle(p);var d=new google.maps.Marker({position:h,map:map,title:a+" specimens; Error(m)="+c,contentString:v,zIndex:10});t.push(d);var v=a+" specimens; Error(m)="+c+'<br><span class="likeLink" onclick="addCoordinates('+"'"+f+","+l+"'"+');">add point to search</span>';google.maps.event.addListener(d,"click",function(){n.setContent(this.contentString);n.open(map,this)})}var m=new google.maps.LatLngBounds;for(var s=0;s<t.length;s++){m.extend(t[s].getPosition())}if(m.getNorthEast().equals(m.getSouthWest())){var g=new google.maps.LatLng(m.getNorthEast().lat()+.05,m.getNorthEast().lng()+.05);var y=new google.maps.LatLng(m.getNorthEast().lat()-.05,m.getNorthEast().lng()-.05);m.extend(g);m.extend(y)}map.fitBounds(m)});$("#customizeButton").live("click",function(e){var t="/info/SpecimenResultsPrefs.cfm";$("<div class='popupDialog'><img src='/images/indicator.gif'></div>").dialog({autoOpen:true,closeOnEscape:true,height:"auto",modal:true,position:["center","center"],title:"Customize results and downloads. Excessive options adversely affect performance.",width:"auto",buttons:{"Save and refresh":function(){closeCustom()}}}).load(t,function(){$(this).dialog("option","position",["center","center"])});$(window).resize(function(){$(".ui-dialog-content").dialog("option","position",["center","center"])})})