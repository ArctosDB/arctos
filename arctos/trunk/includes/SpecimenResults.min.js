var map,bounds,markers=[]; function initializeMap(){$("#spresmapdiv").html("");new google.maps.InfoWindow;var a={zoom:3,center:new google.maps.LatLng(55,-135),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,scaleControl:!0};map=new google.maps.Map(document.getElementById("spresmapdiv"),a);a=$("#cfgml").val();if(0==a.length)return!1;for(var a=a.split(";"),b=0;b<a.length;b++)createMarker(a[b]);a=new google.maps.LatLngBounds;for(b=0;b<markers.length;b++)a.extend(markers[b].getPosition());if(a.getNorthEast().equals(a.getSouthWest())){var b=new google.maps.LatLng(a.getNorthEast().lat()+ .05,a.getNorthEast().lng()+.05),d=new google.maps.LatLng(a.getNorthEast().lat()-.05,a.getNorthEast().lng()-.05);a.extend(b);a.extend(d)}map.fitBounds(a)} function createMarker(a){var b=a.split(",");a=b[0];var d=b[1],e=b[2],b=b[3],c=new google.maps.LatLng(d,e),f={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.15,map:map,center:c,radius:parseInt(b),zIndex:-99},d=a+" specimens; Error(m)="+b+'<br><span class="likeLink" onclick="addCoordinates(\''+d+","+e+"');\">add point to search</span>";crcl=new google.maps.Circle(f);var g=new google.maps.Marker({position:c,map:map,title:a+" specimens; Error(m)="+b,contentString:d, zIndex:10});markers.push(g);var h=new google.maps.InfoWindow({content:d});google.maps.event.addListener(g,"click",function(){h.open(map,g)})}function confirmAddAllDL(){if(1==confirm("Are you sure you want to add all these specimens to the data loan?"))document.location="/Loan.cfm?action=addAllDataLoanItems&transaction_id="+$("#transaction_id").val();else return!1} function confirmAddAllPartLoan(){var a=$("#part_name").val();if(1==confirm("Are you sure you want to add all found "+a+" to the loan?"))document.location="/Loan.cfm?action=addAllSrchResultLoanItems&transaction_id="+$("#transaction_id").val()+"&part_name="+encodeURIComponent(a);else return!1} $(document).ready(function(){jQuery("#cntr_refineSearchTerms").html("<img src='/images/indicator.gif'>");jQuery.get("/component/SpecimenResults.cfc?method=get_specSrchTermWidget&returnformat=plain",function(a){jQuery("#cntr_refineSearchTerms").html(a)});initializeMap();$("#srmapctrls-nomap").click(function(){resizeMap("smallmap")});$("#usertools").change(function(){"BerkeleyMapper"==this.value?window.open("/bnhmMaps/bnhmMapData.cfm?"+$("#mapURL").val(),"_blank"):"BerkeleyMapperRM"==this.value?window.open("/bnhmMaps/bnhmMapData.cfm?showRangeMaps=true&"+ $("#mapURL").val(),"_blank"):"google"==this.value&&window.open("/bnhmMaps/kml.cfm","_blank")})}); function toggleSearchTerms(){var a=$("#refineSearchTerms").is(":visible")?0:1;jQuery.getJSON("/component/functions.cfc",{method:"setResultsBrowsePrefs",val:a,returnformat:"json",queryformat:"column"},function(){1==a?(jQuery("#cntr_refineSearchTerms").html("<img src='/images/indicator.gif'>"),jQuery.get("/component/SpecimenResults.cfc?method=get_specSrchTermWidget&returnformat=plain",function(a){jQuery("#cntr_refineSearchTerms").html(a)})):($("#refineSearchTerms").remove(),$("#aboutSTWH").remove(), $("#fbSWT").remove())})} function pickedTool(){var a;a=$("#usertools").val();"BerkeleyMapper"==a?window.open("/bnhmMaps/bnhmMapData.cfm?"+$("#mapURL").val(),"_blank"):"BerkeleyMapperRM"==a?window.open("/bnhmMaps/bnhmMapData.cfm?showRangeMaps=true&"+$("#mapURL").val(),"_blank"):"google"==a?window.open("/bnhmMaps/kml.cfm","_blank"):"customize"==a?openCustomize():"removeRows"==a?removeRows():"saveSearch"==a?t=saveSearch($("#ServerRootUrl").val()+"/SpecimenResults.cfm?"+$("#mapURL").val()):"download"==a&&window.open("/SpecimenResultsDownload.cfm?tableName="+ $("#SpecSrchTab").val(),"_blank");$("#usertools").val("")} function openCustomize(){$("<div class='popupDialog'><img src='/images/indicator.gif'></div>").dialog({autoOpen:!0,closeOnEscape:!0,height:"auto",modal:!0,position:["center","center"],title:"Customize results and downloads. Excessive options adversely affect performance.",width:"auto",buttons:{"Save and refresh":function(){closeCustom()}}}).load("/info/SpecimenResultsPrefs.cfm",function(){$(this).dialog("option","position",["center","center"])});$(window).resize(function(){$(".ui-dialog-content").dialog("option", "position",["center","center"])})}function resizeMap(a){"nomap"==a?($("#srmapctrls-nomap").show(),$("#srmapctrls").hide(),$("#spresmapdiv").hide()):($("#srmapctrls-nomap").hide(),$("#srmapctrls").show(),$("#spresmapdiv").show(),$("#spresmapdiv").removeClass().addClass(a),initializeMap());jQuery.getJSON("/component/functions.cfc",{method:"changeUserPreference",pref:"srmapclass",val:a,returnformat:"json",queryformat:"column"})} $("#customizeButton").live("click",function(a){$("<div class='popupDialog'><img src='/images/indicator.gif'></div>").dialog({autoOpen:!0,closeOnEscape:!0,height:"auto",modal:!0,position:["center","center"],title:"Customize results and downloads. Excessive options adversely affect performance.",width:"auto",buttons:{"Save and refresh":function(){closeCustom()}}}).load("/info/SpecimenResultsPrefs.cfm",function(){$(this).dialog("option","position",["center","center"])});$(window).resize(function(){$(".ui-dialog-content").dialog("option", "position",["center","center"])})});function closeCustom(){var a="SpecimenResults.cfm?"+$("#mapURL").val();window.location=a}function getPostLoadJunk(){var a=[];$("div[id^='CatItem_']").each(function(){var b=this.id.split("_")[1];a.push(b)});var b=a.toString();insertMedia(b);insertTypes(b);injectLoanPick();displayMedia()} function displayMedia(a){$("div[id^='jsonmedia_']").each(function(){var a=$.parseJSON($("#"+this.id).html());if(0<a.ROWCOUNT){var d='<div class="shortThumb"><div class="thumb_spcr">&nbsp;</div>';for(i=0;i<a.ROWCOUNT;++i)"audio"==a.DATA.mimecat[i]&&"mp3"==a.DATA.media_uri[i].split(".").pop()?(d+='<div class="one_thumb">',d+="<audio controls>",d+='<source src="'+a.DATA.media_uri[i]+'" type="audio/mp3">',d+='<a href="/exit.cfm?target='+a.DATA.media_uri[i]+'" target="_blank">download</a>',d+="</audio> ", d+='<br><a target="_blank" href="/media/'+a.DATA.media_id[i]+'">Media Detail</a></p></div>'):$.ajax({url:"/component/functions.cfc?method=getMediaPreview&preview_uri="+a.DATA.preview_uri[i]+"&media_type="+a.DATA.mimecat[i]+"&returnformat=json&queryformat=column",dataType:"json",async:!1,success:function(e){d+='<div class="one_thumb">';d+='<a href="/exit.cfm?target='+a.DATA.media_uri[i]+'" target="_blank">';d+='<img src="'+e+'" class="theThumb"></a>';d+="<p>"+a.DATA.mimecat[i]+" ("+a.DATA.mime_type[i]+ ")";d+='<br><a target="_blank" href="/media/'+a.DATA.media_id[i]+'">Media Detail</a></p></div>'}});d+='<div class="thumb_spcr">&nbsp;</div></div>';$("#"+this.id).html(d)}else $("#"+this.id).html("")})} function insertMedia(a){var b=document.createElement("DIV");b.id="ajaxStatus";b.className="ajaxStatus";b.innerHTML="Checking for Media...";document.body.appendChild(b);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getMedia",idList:a,returnformat:"json",queryformat:"column"},function(a){try{var b=document.getElementById("ajaxStatus");b.innerHTML="Processing Media....";for(i=0;i<a.ROWCOUNT;++i){var c,f=a.DATA.COLLECTION_OBJECT_ID[i],g=a.DATA.MEDIA_ID[i],h=a.DATA.MEDIA_RELATIONSHIP[i];"cataloged_item"== h?c="CatItem_"+f:"collecting_event"==h&&(c="SpecLocality_"+f);if(0<c.length){var l=document.getElementById(c),k='<a href="/MediaSearch.cfm?action=search&media_id='+g+'" class="mediaLink" target="_blank" id="mediaSpan_'+f+'">',k=k+"Media",k=k+"</a>";l.innerHTML+=k}}document.body.removeChild(b)}catch(m){b=document.getElementById("ajaxStatus"),document.body.removeChild(b)}})} function insertTypes(a){var b=document.createElement("DIV");b.id="ajaxStatus";b.className="ajaxStatus";b.innerHTML="Checking for Types...";document.body.appendChild(b);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getTypes",idList:a,returnformat:"json",queryformat:"column"},function(a){var b=document.getElementById("ajaxStatus");try{for(b.innerHTML="Processing Types....",i=0;i<a.ROWCOUNT;++i){var c=a.DATA.TYPELIST[i],f="CatItem_"+a.DATA.COLLECTION_OBJECT_ID[i];if(0<f.length){var g=document.getElementById(f); g.innerHTML+='<div class="showType">'+c+"</div>"}}}catch(h){}document.body.removeChild(b)})} function injectLoanPick(){var a=$("#transaction_id").val();a&&($("body").append('<div id="ajaxStatus" class="ajaxStatus">Feching Loan Pick...</div>'),jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getLoanPartResults",transaction_id:a,returnformat:"json",queryformat:"column"},function(a){$("div[id^='CatItem_']").each(function(){var d=this.id.split(/_(.+)?/)[1],e=!1,c='<table border width="100%">';for(i=0;i<a.ROWCOUNT;++i)a.DATA.COLLECTION_OBJECT_ID[i]==d&&(e=!0,c+='<tr><td nowrap="nowrap" class="specResultPartCell"><i>'+ a.DATA.PART_NAME[i],0<a.DATA.SAMPLED_FROM_OBJ_ID[i]&&(c+="&nbsp;sample"),c+="&nbsp;("+a.DATA.COLL_OBJ_DISPOSITION[i]+")</i> ["+a.DATA.BARCODE[i]+"]",c+='</td><td nowrap="nowrap" class="specResultPartCell">',c+='Remark:&nbsp;<input type="text" name="item_remark" size="10" id="item_remark_'+a.DATA.PARTID[i]+'">',c+='</td><td nowrap="nowrap" class="specResultPartCell">',c+='Instr.:&nbsp;<input type="text" name="item_instructions" size="10" id="item_instructions_'+a.DATA.PARTID[i]+'">',c+='</td><td nowrap="nowrap" class="specResultPartCell">', c+='Subsample?:&nbsp;<input type="checkbox" name="subsample" id="subsample_'+a.DATA.PARTID[i]+'">',c+='</td><td nowrap="nowrap" class="specResultPartCell">',c+='<input type="button" id="theButton_'+a.DATA.PARTID[i]+'"',c+=' class="insBtn"',0<a.DATA.TRANSACTION_ID[i]?c+=' onclick="" value="In Loan">':(c+=' value="Add" onclick="addPartToLoan(',c+=a.DATA.PARTID[i]+');">'),null!==a.DATA.ENCUMBRANCE_ACTION[i]&&(c+="<br><i>Encumbrances:&nbsp;"+a.DATA.ENCUMBRANCE_ACTION[i]+"</i>"),c+="</td></tr>");e&&(c+= "</table>",$("#CatItem_"+d).append(c))});$("#ajaxStatus").remove()}))} function addPartToLoan(a){var b="item_instructions_"+a,d="subsample_"+a,e=document.getElementById("item_remark_"+a).value,b=document.getElementById(b).value,d=document.getElementById(d).checked,d=1==d?1:0,c=document.getElementById("transaction_id").value;jQuery.getJSON("/component/functions.cfc",{method:"addPartToLoan",transaction_id:c,partID:a,remark:e,instructions:b,subsample:d,returnformat:"json",queryformat:"column"},function(a){a=a.split("|");1==a[0]?(a=document.getElementById("theButton_"+a[1]), a.value="In Loan",a.onclick=""):alert("An error occured!\n"+a[1])})}function reporter(a){var b=document.getElementById("goWhere").value;if(0==b.length)return alert("Pick a tool, then click the button."),!1;var d=b,e="?";0<b.indexOf("?")&&(e="&");d=d+e+("&table_name="+a);d+="&sort=guid";$("#goWhere")[0].selectedIndex=0;window.open(d)} function removeRows(){var a=$("#specresults").jtable("selectedRows");if(0<a.length){var b=[];a.each(function(){var a=$(this).data("record");b.push(a.COLLECTION_OBJECT_ID)});a="/SpecimenResults.cfm?"+$("#mapURL").val()+"&exclCollObjId="+b.join(",");document.location=a}else alert("select rows, then click")} function addCoordinates(a){$("#refineSearchTerms").is(":visible")?$("#coordinates").length?$("#coordinates").val(a):jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"coordinates",returnformat:"json",queryformat:"column"},function(b){$("#stermwdgtbl tr:last").after(b);$("#newTerm option[value='coordinates']").remove();$("#coordinates").val(a)}):alert("turn search terms on, then try that")} function queryByViewport(){if(!$("#refineSearchTerms").is(":visible"))return alert("Turn on the refine widget, then try that click."),!1;var a=map.getBounds(),b=a.getNorthEast().lat(),d=a.getNorthEast().lng(),e=a.getSouthWest().lat(),c=a.getSouthWest().lng();0==$("#nelat").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"nelat",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);$("#newTerm option[value='nelat']").remove(); $("#nelat").val(b)}):$("#nelat").val(b);0==$("#nelong").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"nelong",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);$("#newTerm option[value='nelong']").remove();$("#nelong").val(d)}):$("#nelong").val(d);0==$("#swlat").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"swlat",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a); $("#newTerm option[value='swlat']").remove();$("#swlat").val(e)}):$("#swlat").val(e);0==$("#swlong").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"swlong",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);$("#newTerm option[value='swlong']").remove();$("#swlong").val(c)}):$("#swlong").val(c)} function addARow(a){jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:a,returnformat:"json"},function(b){$("#stermwdgtbl tr:last").after(b);$("#newTerm option[value='"+a+"']").remove()})}function removeTerm(a){$("#"+a).remove();$("#row_"+a).remove()}function clearAll(){$("##refineResults").find("input[type=text]").val("")} function checkMapBB(){if(0<$("#nelat").length&&0<$("#nelong").length&&0<$("#swlat").length&&0<$("#swlong").length){var a=new google.maps.LatLng($("#swlat").val(),$("#swlong").val()),b=new google.maps.LatLng($("#nelat").val(),$("#nelong").val()),a=new google.maps.LatLngBounds(a,b);map.fitBounds(a)}};