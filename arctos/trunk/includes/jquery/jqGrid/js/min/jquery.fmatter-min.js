/*
**
 * Formatter for values but most of the values if for jqGrid
 * Joshua Burnett josh@9ci.com	
 * http://www.greenbill.com
 */
;(function(b){b.fmatter={};b.fn.fmatter=function(d,e,c,f){c=b.extend({},b.jgrid.formatter,c);return this.each(function(){$this=b(this);var a=b.meta?b.extend({},c,$this.data()):c;z($this,d,e,c,f)})};b.fmatter.util={NumberFormat:function(a,d){if(!isNumber(a)){a*=1}if(isNumber(a)){var e=(a<0);var c=a+"";var f=(d.decimalSeparator)?d.decimalSeparator:".";var g;if(isNumber(d.decimalPlaces)){var h=d.decimalPlaces;var m=Math.pow(10,h);c=Math.round(a*m)/m+"";g=c.lastIndexOf(".");if(h>0){if(g<0){c+=f;g=c.length-1}else if(f!=="."){c=c.replace(".",f)}while((c.length-1-g)<h){c+="0"}}}if(d.thousandsSeparator){var l=d.thousandsSeparator;g=c.lastIndexOf(f);g=(g>-1)?g:c.length;var i=c.substring(g);var k=-1;for(var j=g;j>0;j--){k++;if((k%3===0)&&(j!==g)&&(!e||(j>1))){i=l+i}i=c.charAt(j-1)+i}c=i}c=(d.prefix)?d.prefix+c:c;c=(d.suffix)?c+d.suffix:c;return c}else{return a}},DateFormat:function(e,c,f,g){var h=/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,m=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,l=l=/[^-+\dA-Z]/g,i=function(a,d){a=String(a);d=parseInt(d)||2;while(a.length<d)a='0'+a;return a},k={m:1,d:1,y:1970,h:0,i:0,s:0},j=0,n=["i18n"];n["i18n"]={dayNames:g.dayNames,monthNames:g.monthNames};e=e.toLowerCase();c=c.split(/[\\\/:_;.tT\s-]/);e=e.split(/[\\\/:_;.tT\s-]/);for(var o=0;o<e.length;o++){k[e[o]]=parseInt(c[o],10)}k.m=parseInt(k.m)-1;var s=k.y;if(s>=70&&s<=99)k.y=1900+k.y;else if(s>=0&&s<=69)k.y=2000+k.y;j=new Date(k.y,k.m,k.d,k.h,k.i,k.s,0);if(g.masks.newformat){f=g.masks.newformat}else if(!f){f='Y-m-d'}var p=j.getHours(),o=j.getMinutes(),t=j.getDate(),q=j.getMonth()+1,w=j.getTimezoneOffset(),A=j.getSeconds(),B=j.getMilliseconds(),u=j.getDay(),r=j.getFullYear(),v=(u+6)%7+1,x=(new Date(r,q-1,t)-new Date(r,0,1))/86400000,y={d:i(t),D:n.i18n.dayNames[u],j:t,l:n.i18n.dayNames[u+7],N:v,S:g.S(t),w:u,z:x,W:v<5?Math.floor((x+v-1)/7)+1:Math.floor((x+v-1)/7)||((new Date(r-1,0,1).getDay()+6)%7<4?53:52),F:n.i18n.monthNames[q-1+12],m:i(q),M:n.i18n.monthNames[q-1],n:q,t:'?',L:'?',o:'?',Y:r,y:String(r).substring(2),a:p<12?g.AmPm[0]:g.AmPm[1],A:p<12?g.AmPm[2]:g.AmPm[3],B:'?',g:p%12||12,G:p,h:i(p%12||12),H:i(p),i:i(o),s:i(A),u:B,e:'?',I:'?',O:(w>0?"-":"+")+i(Math.floor(Math.abs(w)/60)*100+Math.abs(w)%60,4),P:'?',T:(String(j).match(m)||[""]).pop().replace(l,""),Z:'?',c:'?',r:'?',U:Math.floor(j/1000)};return f.replace(h,function(a){return a in y?y[a]:a.substring(1)})}};b.fn.fmatter.defaultFormat=function(a,d,e){b(a).html((isValue(d)&&d!=="")?d:"&#160;")};b.fn.fmatter.email=function(a,d,e){if(!isEmpty(d)){b(a).html("<a href=\"mailto:"+d+"\">"+d+"</a>")}else{b.fn.fmatter.defaultFormat(a,d)}};b.fn.fmatter.checkbox=function(a,d,e){d=d+"";d=d.toLowerCase();var c=d.search(/(false|0|no|off)/i)<0?" checked=\"checked\"":"";b(a).html("<input type=\"checkbox\""+c+" value=\""+d+"\" offval=\"no\" disabled/>")},b.fn.fmatter.link=function(a,d,e){if(!isEmpty(d)){b(a).html("<a href=\""+d+"\">"+d+"</a>")}else{b(a).html(isValue(d)?d:"")}};b.fn.fmatter.showlink=function(a,d,e){var c={baseLinkUrl:e.baseLinkUrl,showAction:e.showAction,addParam:e.addParam};if(!isUndefined(e.colModel.formatoptions)){c=b.extend({},c,e.colModel.formatoptions)}idUrl=c.baseLinkUrl+c.showAction+'?id='+e.rowId+c.addParam;if(isString(d)){b(a).html("<a href=\""+idUrl+"\">"+d+"</a>")}else{b.fn.fmatter.defaultFormat(a,d)}};b.fn.fmatter.integer=function(a,d,e){var c=b.extend({},e.integer);if(!isUndefined(e.colModel.formatoptions)){c=b.extend({},c,e.colModel.formatoptions)}if(isEmpty(d)){d=c.defaultValue||0}b(a).html(b.fmatter.util.NumberFormat(d,c))};b.fn.fmatter.number=function(a,d,e){var c=b.extend({},e.number);if(!isUndefined(e.colModel.formatoptions)){c=b.extend({},c,e.colModel.formatoptions)}if(isEmpty(d)){d=c.defaultValue||0}b(a).html(b.fmatter.util.NumberFormat(d,c))};b.fn.fmatter.currency=function(a,d,e){var c=b.extend({},e.currency);if(!isUndefined(e.colModel.formatoptions)){c=b.extend({},c,e.colModel.formatoptions)}if(isEmpty(d)){d=c.defaultValue||0}b(a).html(b.fmatter.util.NumberFormat(d,c))};b.fn.fmatter.date=function(a,d,e,c){var f=b.extend({},e.date);if(!isUndefined(e.colModel.formatoptions)){f=b.extend({},f,e.colModel.formatoptions)}if(!f.reformatAfterEdit&&c=='edit'){b.fn.fmatter.defaultFormat(a,d)}else if(!isEmpty(d)){var g=b.fmatter.util.DateFormat(f.srcformat,d,f.newformat,f);b(a).html(g)}else{b.fn.fmatter.defaultFormat(a,d)}};b.fn.fmatter.select=function(e,c,f,g){if(g=='edit'){b.fn.fmatter.defaultFormat(e,c)}else if(!isEmpty(c)){var h=false;if(!isUndefined(f.colModel.editoptions)){h=f.colModel.editoptions.value}if(h){var m=[];var l=f.colModel.editoptions.multiple===true?true:false;var i=[];if(l){i=c.split(",");i=b.map(i,function(a){return b.trim(a)})}if(isString(h)){var k=h.split(";"),j=0;for(var n=0;n<k.length;n++){sv=k[n].split(":");if(l){if(jQuery.inArray(sv[0],i)>-1){m[j]=sv[1];j++}}else if(b.trim(sv[0])==b.trim(c)){m[0]=sv[1];break}}}else if(isObject(h)){if(l){m=jQuery.map(scel,function(a,d){return h[a]})}m[0]=h[c]||""}b(e).html(m.join(", "))}else{b.fn.fmatter.defaultFormat(e,c)}}};b.unformat=function(a,d,e,c){var f,g=d.colModel.formatter,h=d.colModel.formatoptions||{};if(g!=='undefined'&&isString(g)){var m=b.jgrid.formatter||{},l;switch(g){case'link':case'showlink':case'email':f=b(a).text();break;case'integer':h=b.extend({},m.integer,h);l=eval("/"+h.thousandsSeparator+"/g");f=b(a).text().replace(l,'');break;case'number':h=b.extend({},m.number,h);l=eval("/"+h.thousandsSeparator+"/g");f=b(a).text().replace(h.decimalSeparator,'.').replace(l,"");break;case'currency':h=b.extend({},m.currency,h);l=eval("/"+h.thousandsSeparator+"/g");f=b(a).text().replace(h.decimalSeparator,'.').replace(h.prefix,'').replace(h.suffix,'').replace(l,'');break;case'checkbox':var i=(d.colModel.editoptions)?d.colModel.editoptions.value.split(":"):["Yes","No"];f=b('input',a).attr("checked")?i[0]:i[1];break}}return f?f:c===true?b(a).text():b.htmlDecode(b(a).html())};function z(a,d,e,c,f){d=d.toLowerCase();switch(d){case'link':b.fn.fmatter.link(a,e,c);break;case'showlink':b.fn.fmatter.showlink(a,e,c);break;case'email':b.fn.fmatter.email(a,e,c);break;case'currency':b.fn.fmatter.currency(a,e,c);break;case'date':b.fn.fmatter.date(a,e,c,f);break;case'number':b.fn.fmatter.number(a,e,c);break;case'integer':b.fn.fmatter.integer(a,e,c);break;case'checkbox':b.fn.fmatter.checkbox(a,e,c);break;case'select':b.fn.fmatter.select(a,e,c,f);break}};function C(a){if(window.console&&window.console.log)window.console.log(a)};isValue=function(a){return(isObject(a)||isString(a)||isNumber(a)||isBoolean(a))};isBoolean=function(a){return typeof a==='boolean'};isNull=function(a){return a===null};isNumber=function(a){return typeof a==='number'&&isFinite(a)};isString=function(a){return typeof a==='string'};isEmpty=function(a){if(!isString(a)&&isValue(a)){return false}else if(!isValue(a)){return true}a=b.trim(a).replace(/\&nbsp\;/ig,'').replace(/\&#160\;/ig,'');return a===""};isUndefined=function(a){return typeof a==='undefined'};isObject=function(a){return(a&&(typeof a==='object'||isFunction(a)))||false};isFunction=function(a){return typeof a==='function'}})(jQuery);