/*
 * jqGrid extension for constructing Grid Data from external file
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/ 
 */
;(function(d){d.fn.extend({jqGridImport:function(a){a=d.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"}},a||{});return this.each(function(){var h=this;var k=function(b,c){var f=d(c.xmlGrid.config,b)[0];var g=d(c.xmlGrid.data,b)[0];if(xmlJsonClass.xml2json&&JSON.parse){var e=xmlJsonClass.xml2json(f," ");var e=JSON.parse(e);for(var i in e){var jstr1=e[i]}if(g){var m=e.grid.datatype;e.grid.datatype='xmlstring';e.grid.datastr=b;d(h).jqGrid(jstr1).setGridParam({datatype:m})}else{d(h).jqGrid(jstr1)}e=null;jstr1=null}else{alert("xml2json or json.parse are not present")}};var l=function(b,c){if(b&&typeof b=='string'&&JSON.parse){var f=JSON.parse(b);var g=f[c.jsonGrid.config];var e=f[c.jsonGrid.data];if(e){var i=g.datatype;g.datatype='jsonstring';g.datastr=e;d(h).jqGrid(g).setGridParam({datatype:i})}else{d(h).jqGrid(g)}}};switch(a.imptype){case'xml':d.ajax({url:a.impurl,type:a.mtype,data:a.impData,dataType:"xml",complete:function(b,c){if(c=='success'){k(b.responseXML,a);b=null}}});break;case'xmlstring':if(a.impstring&&typeof a.impstring=='string'){var j=xmlJsonClass.parseXml(a.impstring);if(j){k(j,a);j=null}}break;case'json':d.ajax({url:a.impurl,type:a.mtype,data:a.impData,dataType:"json",complete:function(b,c){if(c=='success'){l(b.responseText,a);b=null}}});break;case'jsonstring':if(a.impstring&&typeof a.impstring=='string'){l(a.impstring,a)}break}})},jqGridExport:function(c){c=d.extend({exptype:"xmlstring"},c||{});var f=null;this.each(function(){if(!this.grid){return}var b=d(this).getGridParam();switch(c.exptype){case'xmlstring':f=xmlJsonClass.json2xml(b," ");break;case'jsonstring':f=JSON.stringify(b);break}});return f}})})(jQuery);