<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>CFAjax - Voting Example</title>
		<style type="text/css">
			body {
				font-family: Verdana, Arial, Helvetica, sans-serif;
				font-size:12px;
			}
			.tbl {
				border-width: 5px;
				background-color: white;
			}
			.tbl td { 
				font-size: small; 
				padding-top:10px;
				padding-left:5px;
				padding-bottom:10px;
				padding-right:5px;
			}
		
			.message {
				position:absolute;
				top:0px;
				right:0px;
				color:#FFFFFF;
				font-family:Arial, Helvetica, sans-serif;
				padding:4px;
			}	
		</style>
		<script type='text/javascript' src='/ajax/core/engine.js'></script>
		<script type='text/javascript' src='/ajax/core/util.js'></script>
		<script type='text/javascript' src='/ajax/core/settings.js'></script>
		<script language="javascript">
		
			var data = null;
			var orgSearch = null;
			var loadPageNumber = true;
			
			function getChoiceForCategory()
			{
				var category = DWRUtil.getValue("category");
				DWREngine._execute(_cfscriptVotingLocation, null, 'votingchoice', category, getChoiceForCategoryResult);
			}
		
			function init()
			{
				DWRUtil.useLoadingMessage();
				DWREngine._errorHandler =  errorHandler;
				getChoiceForCategory();
			}
		
			function getChoiceForCategoryResult(tableData)
			{
				// loop through data source
				var output = "";
				if (tableData.length  > 0) 
				{
					output += "<br><table class='tbl' id='myTable1'><tbody id='myTbody'>";
					for (var j = 0; j < tableData.length; j++) {
						output += "<tr class='tr" + (j%2) + "'>";
							output += "<td align='left'>";
								output += "<input type='radio' id='radvote' name='radvote' value=" + (j+1) + "> "
								output += tableData[j] ;
							output += "</td>";
					   output += "</tr>";
					}
					output += "</tbody></table>";
					output += "<br><center><input type='button' id='btnvote' value='Vote Now' onClick='btnVoteClicked()'></center>";
					document.getElementById("tableChoice").innerHTML = output;
				}
			}
			
			function btnVoteClicked()
			{
				var radvote = document.frm.radvote;
				var category = DWRUtil.getValue("category");
				var cnt = -1;
				for (var i=0; i < radvote.length; i++) 
				{
				   if (radvote[i].checked) {cnt = radvote[i].value; i = radvote.length;}
				}
				if (cnt > -1) 
				{
					DWREngine._execute(_cfscriptVotingLocation, null, 'votingresult', category, cnt, votingResult);
				}
				else
				{
					alert('Please make a choice');
				}
			}
		
			function votingResult(tableData)
			{
				// loop through data source
				var output = "";
				if (tableData.length  > 0) 
				{
					output += "<br><table class='tbl' id='myTable1' border='1'><tbody id='myTbody'><tr><th>Votes</td><th>Choices</th></tr>";
					for (var j = 0; j < tableData.length; j++) {
						output += "<tr class='tr" + (j%2) + "'>";
							output += "<td>" + tableData[j].VOTES + "</td>";
							output += "<td align='left'>" + tableData[j].NAME + "</td>";
					   output += "</tr>";
					}
					output += "</tbody></table>";
					document.getElementById("tableChoice").innerHTML = output;
				}
			}
		</script>
	</head>
	<body onLoad="init()">
		<center>
		<h3>CFAjax - Voting Application</h3>
		<br>
		<form name="frm" id="frm">
		<table width="90%">
			<tr>
				<td colspan="2">
					<hr size="1" width="100%">
				</td>
			</tr>
			<tr>
				<td align="center">
					<table>
						<tr>
							<td>Your Vote On :</td>
							<td>
								<select id="category" name="category" onChange="getChoiceForCategory()">
									<option value="1">Best Actress</option>
									<option value="2">Best Actor</option>
									<option value="3">What web scripting language do you use?</option>
								</select>
							</td>
						</tr>
						<tr>
							<td align="center" colspan="2">
								<div id="tableChoice"></div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		
		<!---
		<textarea id="error" name="error" rows="20" cols="80"></textarea>
		--->
		</form>
		</center>
	</body>
</html>




